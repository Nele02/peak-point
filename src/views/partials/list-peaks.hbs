<h2 class="title is-4">Your Peaks</h2>
{{#if categories}}
  <form method="GET" action="/dashboard" class="mb-4">
    <div class="field">
      <div class="control">
        {{#each categories}}
          <label class="checkbox mr-3 mb-2">
            <input
              type="checkbox"
              name="categories"
              value="{{_id}}"
              {{#if selected}}checked{{/if}}
            >
            {{name}}
          </label>
        {{/each}}
      </div>

      <div class="control mt-3">
        <button class="button is-link" type="submit">Filter</button>
      </div>
    </div>
  </form>
{{/if}}

{{#if peaks.length}}
  <div class="columns is-multiline">
    {{#each peaks}}
      <div class="column is-one-third">
        <div class="card peak-card">

          {{#if images}}
            {{#if images.length}}
              <div class="card-image">
                <figure class="image is-4by3">
                  <img
                    class="peak-main-image"
                    src="{{images.[0].url}}"
                    alt="{{name}}"
                  >
                </figure>
              </div>
            {{/if}}
          {{/if}}

          {{#if images}}
            {{#if images.length}}
              <div class="peak-thumbnails is-flex mt-2 is-flex-wrap-wrap">
                {{#each images}}
                  <figure class="image is-48x48 peak-thumbnail mr-2 mb-2">
                    <img src="{{url}}" alt="{{../name}}">
                  </figure>
                {{/each}}
              </div>
            {{/if}}
          {{/if}}

          <div class="card-content">
            <p class="title is-4">{{name}}</p>

            {{#if categories}}
              {{#if categories.length}}
                <p class="subtitle is-6">
                  Categories:
                  {{#each categories}}
                    {{name}}
                    {{#unless @last}}, {{/unless}}
                  {{/each}}
                </p>
              {{/if}}
            {{/if}}

            {{#if this.description}}
              <p class="is-size-5">{{description}}</p>
            {{/if}}

            <p class="is-size-5 mt-2">{{elevation}} m</p>

            <p class="is-size-5 has-text-grey">
              Lat: {{lat}} Â· Lng: {{lng}}
            </p>
          </div>

          <footer class="card-footer">
            <a class="card-footer-item" href="/peaks/{{_id}}/edit">Edit</a>
            <a class="card-footer-item has-text-danger" href="/peaks/{{_id}}/delete">Delete</a>
          </footer>
        </div>
      </div>
    {{/each}}
  </div>
{{else}}
  <p>No peaks yet. Add your first one below.</p>
{{/if}}

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const cards = document.querySelectorAll(".peak-card");

    cards.forEach((card) => {
      const mainImage = card.querySelector(".peak-main-image");
      const thumbnails = card.querySelectorAll(".peak-thumbnail img");

      if (!mainImage || !thumbnails.length) return;

      thumbnails.forEach((thumb) => {
        thumb.addEventListener("click", () => {
          mainImage.src = thumb.src;

          thumbnails.forEach(t => t.classList.remove("is-active-thumbnail"));
          thumb.classList.add("is-active-thumbnail");
        });
      });
    });
  });
</script>

<style>
  .peak-card {
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .peak-thumbnails img {
    cursor: pointer;
    border-radius: 4px;
    border: 2px solid transparent;
  }

  .peak-thumbnails img.is-active-thumbnail {
    border-color: #3273dc;
  }
</style>
