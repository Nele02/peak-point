{{> menu active="dashboard"}}

<section class="section">
  <div class="container">

    <h1 class="title">Edit Peak</h1>

    {{#if errors}}
      <div class="notification is-danger">
        <ul>
          {{#each errors}}
            <li>{{message}}</li>
          {{/each}}
        </ul>
      </div>
    {{/if}}

    <div class="columns">
      <div class="column is-7">
        <div class="box">
          <h2 class="title is-5">Details</h2>

          <form action="/peaks/{{peak._id}}/update" method="POST" enctype="multipart/form-data">
            <div class="field">
              <label class="label">Name</label>
              <div class="control">
                <input class="input" type="text" name="name" value="{{peak.name}}" required>
              </div>
            </div>

            <div class="field">
              <label class="label">Elevation (m)</label>
              <div class="control">
                <input class="input" type="number" step="1" min="0" name="elevation" value="{{peak.elevation}}" required>
              </div>
            </div>

            <div class="field">
              <label class="label">Description</label>
              <div class="control">
                <input class="input" type="text" name="description" value="{{peak.description}}">
              </div>
            </div>

            <div class="field is-horizontal">
              <div class="field-body">
                <div class="field">
                  <label class="label">Latitude</label>
                  <div class="control">
                    <input class="input" type="number" step="0.000001" name="lat" value="{{peak.lat}}" required>
                  </div>
                </div>
                <div class="field">
                  <label class="label">Longitude</label>
                  <div class="control">
                    <input class="input" type="number" step="0.000001" name="lng" value="{{peak.lng}}" required>
                  </div>
                </div>
              </div>
            </div>

            {{#if categories}}
              <div class="field">
                <label class="label">Categories (optional)</label>
                <div class="control">
                  <div class="tags">
                    {{#each categories}}
                      <label class="checkbox mr-3">
                        <input type="checkbox" name="categories" value="{{_id}}" {{#if selected}}checked{{/if}}>
                        {{name}}
                      </label>
                    {{/each}}
                  </div>
                </div>
              </div>
            {{/if}}

            <div class="field">
              <label class="label">Add images</label>
              <div class="control">
                <input class="input" type="file" name="images" accept="image/*" multiple>
              </div>
            </div>

            <div class="field is-grouped">
              <div class="control">
                <button class="button is-link" type="submit">Save</button>
              </div>
              <div class="control">
                <a class="button is-light" href="/dashboard">Cancel</a>
              </div>
            </div>
          </form>
        </div>
      </div>

      <div class="column is-5">
        <div class="box">
          <h2 class="title is-5">Images</h2>

          {{#if peak.images}}
            {{#if peak.images.length}}
              <div class="columns is-multiline">
                {{#each peak.images}}
                  <div class="column is-4">
                    <div class="thumb-wrap">
                      {{#if url}}
                        <img class="thumb-img" src="{{url}}" alt="peak image">
                      {{/if}}
                      <form
                        class="thumb-delete"
                        action="/peaks/{{../peak._id}}/images/{{encodeURIComponent publicId}}/delete"
                        method="POST"
                      >
                        <button class="delete is-small" type="submit" aria-label="delete image"></button>
                      </form>
                    </div>
                  </div>
                {{/each}}
              </div>
              <p class="help">Click the x to remove an image.</p>
            {{else}}
              <p>No images yet.</p>
            {{/if}}
          {{else}}
            <p>No images yet.</p>
          {{/if}}

        </div>
      </div>
    </div>

  </div>
</section>

<style>
  .thumb-wrap {
    position: relative;
    border-radius: 8px;
    overflow: hidden;
  }

  .thumb-img {
    width: 100%;
    height: 120px;
    object-fit: cover;
    display: block;
  }

  .thumb-delete {
    position: absolute;
    top: 6px;
    right: 6px;
  }
</style>
